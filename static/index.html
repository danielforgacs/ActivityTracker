<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeTrack</title>
    <style>
        [active] {
            background-color: green;
        }
        [stopped] {
            background-color: grey;
        }
    </style>
</head>
<body>
    <div>
        <div>
            <table>
                <tr>
                    <td>start time</td>
                    <td id="start_time"></td>
                </tr>
                <tr>
                    <td>elapsed day</td>
                    <td id="elapsed_day"></td>
                </tr>
                <tr>
                    <td>total acivity time</td>
                    <td id="total_activity_time"></td>
                </tr>
                <tr>
                    <td>time diff</td>
                    <td id="time_diff"></td>
                </tr>
            </table>
        </div>
        <div>
            <form id="create_form" onSubmit="return create_activity(event)">
                <input type="text" name="new_name" id="new_name">
                <input type="submit" value="create / activate">
            </form>
            <form onSubmit="event.preventDefault(); fetch('api/stop', {method: 'POST'})">
                <input type="submit" value="stop">
            </form>
        </div>
        <div id="activities">
        </div>
    </div>
</body>
<script>
    // function create_activity(event) {
    //     event.preventDefault()
    //     let name = event.target[0].value
    //     fetch('api/start/'+name, {method: "POST"})
    //     event.target[0].value = ''
    // }

    // function toggle_activity(event) {
    //     let name = event.submitter.getAttribute("activity_name")
    //     if (event.submitter.getAttribute("active") == "active") {
    //         fetch('api/stop', {method: "POST"})
    //     } else {
    //         fetch('api/start/'+name, {method: "POST"})
    //     }
    // }

    // function builder(data) {
    //     console.log(data)
    //     document.getElementById('start_time').innerHTML = data.start_time_pretty
    //     document.getElementById('elapsed_day').innerHTML = data.elapsed_day
    //     document.getElementById('total_activity_time').innerHTML = data.total_activity_time
    //     document.getElementById('time_diff').innerHTML = data.time_difference
    //     let activities_div = document.getElementById('activities')
    //     activities_div.innerHTML = ""
    //     for (activity of data.tasks) {
    //         let form = document.createElement("form")
    //         form.setAttribute('onSubmit', 'event.preventDefault(); toggle_activity(event)')
    //         let button = document.createElement("button")
    //         button.textContent = activity.name + " - " + activity.all_time_pretty
    //         button.setAttribute('activity_name', activity.name)
    //         if (activity.status == "Idle") {
    //             button.setAttribute("stopped", "stopped")
    //         } else {
    //             button.setAttribute("active", "active")
    //         }
    //         form.appendChild(button)
    //         activities_div.appendChild(form)
    //     }
    // }

    let start_time_tag = document.getElementById('start_time')
    let elapsed_day_tag = document.getElementById('elapsed_day')
    let total_activity_time_tag = document.getElementById('total_activity_time')
    let time_diff_tag = document.getElementById('time_diff')
    let activities_div = document.getElementById('activities')

    function header_values(data) {
        start_time_tag.innerHTML = data.start_time_pretty
        elapsed_day_tag.innerHTML = data.elapsed_day
        total_activity_time_tag.innerHTML = data.total_activity_time
        time_diff_tag.innerHTML = data.time_difference
    }

    function mk_activity_button(name, status) {
        let acivity_btn_template = `
        <form onsubmit="event.preventDefault(); __toggle_activity(event)">
            <button id="activity-btn-${name}" activity_name="${name}" stopped="stopped">
                asdfasdfasdf - 2h:39m
            </button>
        </form>
        `
        let activity_form = document.createElement('form')
        activity_form.innerHTML = acivity_btn_template
        activities_div.appendChild(activity_form)
    }

    function body_builder(data) {
        header_values(data)

        for (task of data.tasks) {
            // console.log("task: ", task)
            let task_button = document.getElementById('activity-btn-'+task.name)
            console.log("task button: ", task_button)
            if (task_button === null) {
                mk_activity_button(task.name, "__status")
            }
        }
    }

    setInterval(() => {
        fetch('api/times')
        .then(response => response.json())
        // .then(data => body_builder(data));
        .then(data => body_builder({
    "tasks": [
        {
            "added_at": "asd",
            "status": "Idle",
            "logged_secs": 9577,
            "name": "aaaaaaaaaaaaaaaaa",
            "all_time_pretty": "2h:39m"
        },
        {
            "added_at": "bbbbbbbbbbbbbb",
            "status": "Idle",
            "logged_secs": 9577,
            "name": "bbbbbbbbbbb",
            "all_time_pretty": "2h:39m"
        }
    ],
    "start_time_pretty": "asdfasdf",
    "elapsed_day": "03h:01m",
    "total_activity_time": "02h:39m",
    "time_difference": "00h:21m",
    "start_time:": 1658910340,
    "display:": "start time:         2022-07-27 09:25:40.685335729 +01:00\nelapsed day:        03h:01m\ntotal acivity time: 02h:39m\n  PIPE_1476_SPIKE_Are_houdini_depenencies_tracked: 2h:39m\n"
        }));
    }, 5000);
</script>
</html>
